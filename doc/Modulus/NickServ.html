<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Modulus::NickServ</title>

	<link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

	<script src="../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../modules/NickServ/main_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="modules/NickServ/main.rb">modules/NickServ/main.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link"><a href="../Object.html">Object</a></p>
				
			</div>
			

			<!-- Namespace Contents -->
			
			<div id="namespace-list-section" class="section">
				<h3 class="section-header">Namespace</h3>
				<ul class="link-list">
					
					<li><span class="type">CLASS</span> <a href="NickServ/Account.html">Modulus::NickServ::Account</a></li>
					
					<li><span class="type">CLASS</span> <a href="NickServ/Nick.html">Modulus::NickServ::Nick</a></li>
					
				</ul>
			</div>
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-new">::new</a></li>
					
					<li><a href="#method-i-cmd_ns_drop">#cmd_ns_drop</a></li>
					
					<li><a href="#method-i-cmd_ns_identify">#cmd_ns_identify</a></li>
					
					<li><a href="#method-i-cmd_ns_list">#cmd_ns_list</a></li>
					
					<li><a href="#method-i-cmd_ns_register">#cmd_ns_register</a></li>
					
					<li><a href="#method-i-cmd_ns_unidentify">#cmd_ns_unidentify</a></li>
					
					<li><a href="#method-i-dbConnected">#dbConnected</a></li>
					
					<li><a href="#method-i-logIn">#logIn</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="../LICENSE.html">LICENSE</a></li>
				
					<li class="file"><a href="../README.html">README</a></li>
				
					<li class="file"><a href="../Rakefile.html">Rakefile</a></li>
				
					<li class="file"><a href="../head.html">head</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../Modulus.html">Modulus</a></li>
				
					<li><a href="../Modulus/Account.html">Modulus::Account</a></li>
				
					<li><a href="../Modulus/BanServ.html">Modulus::BanServ</a></li>
				
					<li><a href="../Modulus/BanServ/Autokill.html">Modulus::BanServ::Autokill</a></li>
				
					<li><a href="../Modulus/BanServ/Regexkill.html">Modulus::BanServ::Regexkill</a></li>
				
					<li><a href="../Modulus/BotServ.html">Modulus::BotServ</a></li>
				
					<li><a href="../Modulus/BotServ/BotServBot.html">Modulus::BotServ::BotServBot</a></li>
				
					<li><a href="../Modulus/BotServ/BotServChannel.html">Modulus::BotServ::BotServChannel</a></li>
				
					<li><a href="../Modulus/ChanServ.html">Modulus::ChanServ</a></li>
				
					<li><a href="../Modulus/ChanServ/Channel.html">Modulus::ChanServ::Channel</a></li>
				
					<li><a href="../Modulus/ChanServ/ChannelUsers.html">Modulus::ChanServ::ChannelUsers</a></li>
				
					<li><a href="../Modulus/Channel.html">Modulus::Channel</a></li>
				
					<li><a href="../Modulus/ChannelUser.html">Modulus::ChannelUser</a></li>
				
					<li><a href="../Modulus/Channels.html">Modulus::Channels</a></li>
				
					<li><a href="../Modulus/Clients.html">Modulus::Clients</a></li>
				
					<li><a href="../Modulus/Command.html">Modulus::Command</a></li>
				
					<li><a href="../Modulus/Config.html">Modulus::Config</a></li>
				
					<li><a href="../Modulus/EventCallback.html">Modulus::EventCallback</a></li>
				
					<li><a href="../Modulus/Events.html">Modulus::Events</a></li>
				
					<li><a href="../Modulus/Hook.html">Modulus::Hook</a></li>
				
					<li><a href="../Modulus/HostServ.html">Modulus::HostServ</a></li>
				
					<li><a href="../Modulus/HostServ/Host.html">Modulus::HostServ::Host</a></li>
				
					<li><a href="../Modulus/Log.html">Modulus::Log</a></li>
				
					<li><a href="../Modulus/Module.html">Modulus::Module</a></li>
				
					<li><a href="../Modulus/ModuleManager.html">Modulus::ModuleManager</a></li>
				
					<li><a href="../Modulus/NickServ.html">Modulus::NickServ</a></li>
				
					<li><a href="../Modulus/NickServ/Account.html">Modulus::NickServ::Account</a></li>
				
					<li><a href="../Modulus/NickServ/Nick.html">Modulus::NickServ::Nick</a></li>
				
					<li><a href="../Modulus/OperServ.html">Modulus::OperServ</a></li>
				
					<li><a href="../Modulus/OriginInfo.html">Modulus::OriginInfo</a></li>
				
					<li><a href="../Modulus/Parser.html">Modulus::Parser</a></li>
				
					<li><a href="../Modulus/ProtocolAbstraction.html">Modulus::ProtocolAbstraction</a></li>
				
					<li><a href="../Modulus/ProtocolAbstractionMixin.html">Modulus::ProtocolAbstractionMixin</a></li>
				
					<li><a href="../Modulus/Pseudoclient.html">Modulus::Pseudoclient</a></li>
				
					<li><a href="../Modulus/QuoteServ.html">Modulus::QuoteServ</a></li>
				
					<li><a href="../Modulus/QuoteServ/Quote.html">Modulus::QuoteServ::Quote</a></li>
				
					<li><a href="../Modulus/QuoteServ/QuoteChannel.html">Modulus::QuoteServ::QuoteChannel</a></li>
				
					<li><a href="../Modulus/QuoteServ/QuoteRater.html">Modulus::QuoteServ::QuoteRater</a></li>
				
					<li><a href="../Modulus/ReservedNick.html">Modulus::ReservedNick</a></li>
				
					<li><a href="../Modulus/Service.html">Modulus::Service</a></li>
				
					<li><a href="../Modulus/ServiceModules.html">Modulus::ServiceModules</a></li>
				
					<li><a href="../Modulus/User.html">Modulus::User</a></li>
				
					<li><a href="../Modulus/Users.html">Modulus::Users</a></li>
				
					<li><a href="../Object.html">Object</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Modulus::NickServ</h1>

		<div id="description">
			
		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="new-method" class="method-detail ">
				<a name="method-c-new"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
    <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 23</span>
23:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
24:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addService</span>(<span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-keyword kw">self</span>,
25:                          <span class="ruby-value str">&quot;Nick Registration Services
26:                          
27: NickServ allows users to register and protect their
28: nicks.&quot;</span>)
29: 
30:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">register</span>(<span class="ruby-value">:database_connected</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;dbConnected&quot;</span>)
31: 
32:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">addClient</span>(<span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;Nick Registration Service&quot;</span>)
33: 
34:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addCmd</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;IDENTIFY&quot;</span>, <span class="ruby-value str">&quot;cmd_ns_identify&quot;</span>,
35:                      <span class="ruby-value str">&quot;Log in to your account and verify your ownership of your current nick.&quot;</span>,
36:                      <span class="ruby-value str">&quot;Usage: IDENTIFY password
37:  
38: Using this command, you will be identified to your services account.
39: You must have a registered nickname to use this command.&quot;</span>)
40: 
41:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addCmd</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;UNIDENTIFY&quot;</span>, <span class="ruby-value str">&quot;cmd_ns_unidentify&quot;</span>,
42:                      <span class="ruby-value str">&quot;Logs you out of your services account. If you are not logged in, modes are cleared anyway.&quot;</span>,
43:                      <span class="ruby-value str">&quot;Usage: UNIDENTIFY
44:  
45: Using this command will remove all flags from you which indicate you are
46: logged in to a services account. Services will not check if you are logged
47: in and will remove all flags no matter what. This is to help
48: resolve any problems that may arise from network sync problems
49: or other bugs.&quot;</span>)
50: 
51:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addCmd</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;LIST&quot;</span>, <span class="ruby-value str">&quot;cmd_ns_list&quot;</span>,
52:                      <span class="ruby-value str">&quot;List all nicks currently registered to your account.&quot;</span>,
53:                      <span class="ruby-value str">&quot;Usage: LIST
54:  
55: You may use this command to see all nicks that have been registered while
56: you have been logged in to your services account, if any.&quot;</span>)
57: 
58:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addCmd</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;REGISTER&quot;</span>, <span class="ruby-value str">&quot;cmd_ns_register&quot;</span>,
59:                      <span class="ruby-value str">&quot;Register your current nick.&quot;</span>,
60:                      <span class="ruby-value str">&quot;Usage: REGISTER password e-mail [username]
61:  
62: When you attempt to register a nickname, services will check if an account
63: with the specified e-mail address exists. If it does, you must also provide
64: your services account user name. Otherwise, a new account will be created
65: with that e-mail address.
66:  
67: If no username is specified, your current IRC nickname will be used.
68:  
69: Please be sure to remember your username as you will need it to register
70: additional IRC nicknames, and you may need it to use some network services.
71: If you don't remember your services account user name but you are logged in
72: to services, you may be able to view the user name by performing a WHOIS
73: on yourself.&quot;</span>)
74: 
75:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">addCmd</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;DROP&quot;</span>, <span class="ruby-value str">&quot;cmd_ns_drop&quot;</span>,
76:                      <span class="ruby-value str">&quot;Drop the registration of your current nick.&quot;</span>,
77:                      <span class="ruby-value str">&quot;Usage: DROP password
78:  
79: You must give your services account password in order to use this command.
80:  
81: Using this command will completely erase NickServ's record of your current
82: IRC nickname. It will not erase your services account, even if it this
83: is the last nickname registered thereto. This action cannot be undone.
84: If you wish to un-drop a nick, you must re-register it as a new nick, even
85: if the nick was just dropped. To delete your services account entirely,
86: contact your network's staff.&quot;</span>)
87:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="cmd-ns-drop-method" class="method-detail ">
				<a name="method-i-cmd_ns_drop"></a>

				<div class="method-heading">
				
					<span class="method-name">cmd_ns_drop</span><span
						class="method-args">(origin)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cmd-ns-drop-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 175</span>
175:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cmd_ns_drop</span>(<span class="ruby-identifier">origin</span>)
176:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Got: #{origin.raw}&quot;</span>
177:       
178:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
179:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Usage: DROP password&quot;</span>)
180:         <span class="ruby-keyword kw">return</span>
181:       <span class="ruby-keyword kw">end</span>
182: 
183:       <span class="ruby-identifier">source</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>.<span class="ruby-identifier">downcase</span>
184: 
185:       <span class="ruby-identifier">nickRecord</span> = <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">find_by_nick</span>(<span class="ruby-identifier">source</span>)
186: 
187:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nickRecord</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
188:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Your nick is not currently registered.&quot;</span>)
189:       <span class="ruby-keyword kw">else</span>
190:         <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">nickRecord</span>.<span class="ruby-identifier">account_id</span>)
191:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">password</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>[<span class="ruby-value">0</span>]
192:           <span class="ruby-identifier">nickRecord</span>.<span class="ruby-identifier">destroy</span>
193: 
194:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Nick registration dropped.&quot;</span>)
195:           <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;#{source} has dropped their nick registration.&quot;</span>
196: 
197:           <span class="ruby-identifier">nickRecords</span> = <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">find_all_by_account_id</span>(<span class="ruby-identifier">account</span>.<span class="ruby-identifier">id</span>)
198: 
199:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nickRecords</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
200:             <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;You no longer have any nicks registered. Your services account #{account.username} will remain active and may be used to register new nicks or use with other modules.&quot;</span>)
201:           <span class="ruby-keyword kw">end</span>
202:         <span class="ruby-keyword kw">else</span>
203:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Incorrect password.&quot;</span>)
204:         <span class="ruby-keyword kw">end</span>
205:       <span class="ruby-keyword kw">end</span>
206:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="cmd-ns-identify-method" class="method-detail ">
				<a name="method-i-cmd_ns_identify"></a>

				<div class="method-heading">
				
					<span class="method-name">cmd_ns_identify</span><span
						class="method-args">(origin)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cmd-ns-identify-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cmd_ns_identify</span>(<span class="ruby-identifier">origin</span>)
133:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Got: #{origin.raw}&quot;</span>
134:       
135:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
136:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Usage: IDENTIFY password&quot;</span>)
137:         <span class="ruby-keyword kw">return</span>
138:       <span class="ruby-keyword kw">end</span>
139: 
140:       <span class="ruby-identifier">password</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>[<span class="ruby-value">0</span>]
141:       <span class="ruby-identifier">source</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>.<span class="ruby-identifier">downcase</span>
142: 
143:       <span class="ruby-identifier">nickRecord</span> = <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">find_by_nick</span>(<span class="ruby-identifier">source</span>)
144: 
145:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nickRecord</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
146:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Your nick is not registered.&quot;</span>)
147:         <span class="ruby-keyword kw">return</span>
148:       <span class="ruby-keyword kw">end</span>
149: 
150:       <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">nickRecord</span>.<span class="ruby-identifier">account_id</span>)
151: 
152:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">account</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
153:         <span class="ruby-comment cmt"># This should never happen.</span>
154: 
155:         <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">error</span> <span class="ruby-value str">'NickServ'</span>, <span class="ruby-node">&quot;While performing an IDENTIFY, the services account for #{source} could not be found, but the nick is in the database as registered.&quot;</span>
156:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;There was a problem with your request. The services account associated with this nick no longer exists. Please contact your network's staff for assistance.&quot;</span>)
157:         <span class="ruby-keyword kw">return</span>
158:       <span class="ruby-keyword kw">end</span>
159: 
160:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">password</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">password</span>
161:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logIn</span>(<span class="ruby-identifier">account</span>.<span class="ruby-identifier">username</span>, <span class="ruby-identifier">source</span>)
162: 
163:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;You have been identified as the owner of #{source}&quot;</span>)
164:         <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;#{source} has been identified as account #{account.username}.&quot;</span>
165:       <span class="ruby-keyword kw">else</span>
166:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Incorrect password.&quot;</span>)
167:         <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Login failed for #{source}.&quot;</span>
168: 
169:         <span class="ruby-comment cmt">#TODO: Record this. Ban for too many failures.</span>
170:         <span class="ruby-comment cmt">#TODO: Make the above TODO configurable.</span>
171:       <span class="ruby-keyword kw">end</span>
172: 
173:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="cmd-ns-list-method" class="method-detail ">
				<a name="method-i-cmd_ns_list"></a>

				<div class="method-heading">
				
					<span class="method-name">cmd_ns_list</span><span
						class="method-args">(origin)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cmd-ns-list-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 89</span>
 89:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cmd_ns_list</span>(<span class="ruby-identifier">origin</span>)
 90:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Got: #{origin.raw}&quot;</span>
 91: 
 92:       <span class="ruby-identifier">user</span> = <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>)
 93: 
 94:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
 95: 
 96:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">logged_in?</span>
 97:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;You must be logged in to a services account in order to use this command.&quot;</span>)
 98:         <span class="ruby-keyword kw">return</span>
 99:       <span class="ruby-keyword kw">end</span>
100: 
101:       <span class="ruby-identifier">nicks</span> = <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">find_all_by_account_id</span>(<span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_username</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">svid</span>))
102: 
103:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nicks</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
104:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;There are currently no nicks registered to #{user.svid}.&quot;</span>)
105:         <span class="ruby-keyword kw">return</span>
106:       <span class="ruby-keyword kw">end</span>
107: 
108:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nicks</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
109:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;There are currently no nicks registered to #{user.svid}.&quot;</span>)
110:         <span class="ruby-keyword kw">return</span>
111:       <span class="ruby-keyword kw">end</span>
112: 
113:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;Nicks registered to #{user.svid}:&quot;</span>)
114: 
115:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%30.30s  %-25.25s&quot;</span>, <span class="ruby-value str">&quot;Nick&quot;</span>, <span class="ruby-value str">&quot;Date Registered&quot;</span>))
116: 
117:       <span class="ruby-identifier">nicks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">nick</span><span class="ruby-operator">|</span>
118:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%30.30s  %-25.25s&quot;</span>, <span class="ruby-identifier">nick</span>.<span class="ruby-identifier">nick</span>, <span class="ruby-identifier">nick</span>.<span class="ruby-identifier">dateRegistered</span>))
119:       }
120: 
121:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;Total nicks registered: #{nicks.length}&quot;</span>)
122:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="cmd-ns-register-method" class="method-detail ">
				<a name="method-i-cmd_ns_register"></a>

				<div class="method-heading">
				
					<span class="method-name">cmd_ns_register</span><span
						class="method-args">(origin)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cmd-ns-register-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 208</span>
208:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cmd_ns_register</span>(<span class="ruby-identifier">origin</span>)
209:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Got: #{origin.raw}&quot;</span>
210: 
211:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">3</span>
212:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Usage: REGISTER password e-mail [username]&quot;</span>)
213:       <span class="ruby-keyword kw">else</span>
214:         <span class="ruby-identifier">password</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>[<span class="ruby-value">0</span>]
215:         <span class="ruby-identifier">email</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>
216:         <span class="ruby-identifier">source</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>.<span class="ruby-identifier">downcase</span>
217:         
218:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
219:           <span class="ruby-identifier">username</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">argsArr</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">downcase</span>
220:         <span class="ruby-keyword kw">else</span>
221:           <span class="ruby-identifier">username</span> = <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>.<span class="ruby-identifier">downcase</span>
222:         <span class="ruby-keyword kw">end</span>
223: 
224:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">find_by_nick</span>(<span class="ruby-identifier">source</span>)
225:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;The nick #{source} is already registered.&quot;</span>)
226:           <span class="ruby-keyword kw">return</span>
227:         <span class="ruby-keyword kw">end</span>
228: 
229:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ReservedNick</span>.<span class="ruby-identifier">find_by_nick</span>(<span class="ruby-identifier">source</span>)
230:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;The nick #{source} is reserved by services.&quot;</span>)
231:           <span class="ruby-keyword kw">return</span>
232:         <span class="ruby-keyword kw">end</span>
233: 
234:         <span class="ruby-identifier">emailAcc</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">email</span>)
235: 
236:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">emailAcc</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
237:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">username</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">emailAcc</span>.<span class="ruby-identifier">username</span>
238:             <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;The e-mail address #{email} has already been used by a registered user. If this is you, try including your username as well.&quot;</span>)
239:             <span class="ruby-keyword kw">return</span> 
240:           <span class="ruby-keyword kw">end</span>
241:         <span class="ruby-keyword kw">end</span>
242: 
243:         <span class="ruby-identifier">acc</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_username</span>(<span class="ruby-identifier">username</span>)
244: 
245:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">acc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
246:           <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;There is no account for #{username} but a user is trying to register a nick with it. Creating account with given password.&quot;</span>
247: 
248:           <span class="ruby-identifier">acc</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">create</span>(
249:             <span class="ruby-value">:username</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">username</span>,
250:             <span class="ruby-value">:email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">email</span>,
251:             <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password</span>,
252:             <span class="ruby-value">:dateRegistered</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>,
253:             <span class="ruby-value">:verified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
254: 
255:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;I have created a new account for #{username} (#{email}). If you register additional nicks in the future, use this e-mail address and username and the same password to keep nicks attached to this account. Otherwise, managing your services use will becoming confusing for both you and the network staff.&quot;</span>)
256:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">password</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">password</span>
257:           <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;Incorrect password for the existing account with that e-mail address.&quot;</span>)
258:           <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Login failed: #{source} tried to register a new nick for account #{acc.username} but used the wrong password.&quot;</span>
259:           <span class="ruby-keyword kw">return</span>
260:         <span class="ruby-keyword kw">end</span>
261: 
262:         <span class="ruby-comment cmt"># Everyything looks good. Go ahead and make it.</span>
263:         <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">create</span>(
264:           <span class="ruby-value">:account_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">id</span>,
265:           <span class="ruby-value">:nick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">source</span>,
266:           <span class="ruby-value">:dateRegistered</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>)
267: 
268:         <span class="ruby-constant">ReservedNick</span>.<span class="ruby-identifier">create</span>(
269:           <span class="ruby-value">:nick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">source</span>,
270:           <span class="ruby-value">:dateAdded</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>,
271:           <span class="ruby-value">:module</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;NickServ&quot;</span>)
272: 
273:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logIn</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>)
274:         <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-node">&quot;You have registered #{source} to #{username} (#{email}).&quot;</span>)
275:         <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Nick #{source} registered to #{username}.&quot;</span>
276:       <span class="ruby-keyword kw">end</span>
277:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="cmd-ns-unidentify-method" class="method-detail ">
				<a name="method-i-cmd_ns_unidentify"></a>

				<div class="method-heading">
				
					<span class="method-name">cmd_ns_unidentify</span><span
						class="method-args">(origin)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cmd-ns-unidentify-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cmd_ns_unidentify</span>(<span class="ruby-identifier">origin</span>)
125:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-node">&quot;Got: #{origin.raw}&quot;</span>
126: 
127:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">logOut</span>(<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>)
128:      <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">svsmode</span>(<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">source</span>, <span class="ruby-value str">&quot;-r+d *&quot;</span>)
129:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">reply</span>(<span class="ruby-identifier">origin</span>, <span class="ruby-value str">&quot;You have been logged out.&quot;</span>)
130:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="db-onnected-method" class="method-detail ">
				<a name="method-i-dbConnected"></a>

				<div class="method-heading">
				
					<span class="method-name">dbConnected</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="db-onnected-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 290</span>
290:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dbConnected</span>
291:       <span class="ruby-identifier">$log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;NickServ&quot;</span>, <span class="ruby-value str">&quot;Received database_connected callback. Beginning database check.&quot;</span>
292: 
293:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Nick</span>.<span class="ruby-identifier">table_exists?</span>
294:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Schema</span>.<span class="ruby-identifier">define</span> <span class="ruby-keyword kw">do</span>
295:           <span class="ruby-identifier">create_table</span> <span class="ruby-value">:nicks</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
296:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:nick</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
297:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:account_id</span>, <span class="ruby-value">:integer</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
298:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:enforceType</span>, <span class="ruby-value">:string</span>
299:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:dateRegistered</span>, <span class="ruby-value">:datetime</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
300:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:dateLastActive</span>, <span class="ruby-value">:datetime</span>
301:           <span class="ruby-keyword kw">end</span>
302:         <span class="ruby-keyword kw">end</span>
303:       <span class="ruby-keyword kw">end</span>
304: 
305:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="log-n-method" class="method-detail ">
				<a name="method-i-logIn"></a>

				<div class="method-heading">
				
					<span class="method-name">logIn</span><span
						class="method-args">(username, nick)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="log-n-source">
<pre>
     <span class="ruby-comment cmt"># File modules/NickServ/main.rb, line 279</span>
279:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">logIn</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">nick</span>)
280:       <span class="ruby-identifier">user</span> = <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">nick</span>)
281: 
282:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
283:       
284:       <span class="ruby-identifier">user</span>.<span class="ruby-identifier">logIn</span> <span class="ruby-identifier">username</span>
285: 
286:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">link</span>.<span class="ruby-identifier">svsmode</span>(<span class="ruby-identifier">nick</span>, <span class="ruby-node">&quot;+rd #{username}&quot;</span>)
287:       <span class="ruby-constant">Modulus</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">logIn</span>(<span class="ruby-identifier">nick</span>, <span class="ruby-identifier">username</span>)
288:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

